<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Are Sean and Kiernan Brewing by dropdownmenu</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="markdown.js"></script>
    <script src="underscore.min.js"></script>
    <script src="async.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Are Sean and Kiernan Brewing?</h1>
        <h1>Not this second</h1>
        <a href="http://imgur.com/vmCcP52"><img src="http://i.imgur.com/vmCcP52.jpg" title="source: imgur.com" /></a>
      </header>
      <section>
        <h2>What are we brewing?</h2>
        <h3>Winter Companion Spiced Stout (5 gal)</h3>
        <h3>Sacre Blonde Sour(1 gal)</h3>
        <h3>White Girl Wasted White IPA (5 gal)</h3>
      </section>
      <section>
        <h3>Our Beers</h3>
        <table id="results-table" class="table table-hover">
          <tr>
            <th>Name</th>
            <th>Date</th>
          </tr>
        </table>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/dropdownmenu">dropdownmenu</a> | <a href="https://github.com/madtown">madtown</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script type="text/x-template", id="row-template">
      <tr>
      <td><%= name %></td>
      <td><%= date %></td>
      </tr>
      <tr style="display: none">
      <td colspan="2"><%= html %></td>
      </tr>
    </script>
    <script type="text/javascript">
    /* global markdown, async, $, _ */
    $(function() {
      var rowTemplate = _.template($('#row-template').html());
      $.get('manifest.json', function(manifest) {
        // put a date object on each brew
        manifest.brews.forEach(function(b) {
          b.date_obj = new Date(b.date);
        });
        manifest.brews.sort(function(a, b) {
          return b.date_obj.getTime() - a.date_obj.getTime();
        });

        function displayBrew(obj, cb) {
          $.get(manifest.base_path + obj.path, function(data) {
            obj.html = markdown.toHTML(data);
            cb(null, obj);
          }).fail(function() {
            console.error('Failed to get recipie for ' + obj.name);
            cb(null, obj);
          });
        }

        async.map(manifest.brews, displayBrew, function(err, newObjs) {
          newObjs.forEach(function(o) {
            var fragment = $(rowTemplate({
              name: o.name,
              date: o.date,
              html: o.html
            }));
            fragment.first('tr').click(function() {
              console.log('you clicked me!');
              fragment.last('tr').toggle();
            });
            $('#results-table tbody').append(fragment);
          });
        });

      });
    });
    </script>
    <script src="javascripts/scale.fix.js"></script>
  </body>
</html>
